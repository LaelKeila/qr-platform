<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Scan QR Code</title>
    <script src="https://cdn.jsdelivr.net/npm/jsQR/dist/jsQR.js"></script> <!-- Librairie pour scanner le QR code -->
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            background: #f0f0f0;
            color: #333;
        }
        video {
            width: 100%;
            max-width: 500px;
            border: 2px solid #FF6600;
            margin-bottom: 20px;
        }
        h2 {
            color: #FF6600;
        }
    </style>
</head>
<body>
    <h2>Scannez le QR code à l'entrée</h2>
    <video id="video" width="300" height="200" autoplay></video>
    <p id="result">Aucun QR code détecté</p>

    <script>
        // Accéder à la caméra
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(function(stream) {
                var video = document.getElementById('video');
                video.srcObject = stream;
                var canvasElement = document.createElement("canvas");
                var canvas = canvasElement.getContext("2d");

                // Fonction pour scanner le QR code
                function scanQRCode() {
                    if (video.readyState === video.HAVE_ENOUGH_DATA) {
                        canvasElement.height = video.videoHeight;
                        canvasElement.width = video.videoWidth;
                        canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                        var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
                        var code = jsQR(imageData.data, imageData.width, imageData.height);

                        if (code) {
                            // Si QR code détecté, envoie l'ID pour vérification
                            fetch(`/verify/${code.data}`)
                                .then(response => response.json())
                                .then(data => {
                                    if (data.found) {
                                        document.getElementById('result').innerText = `Bienvenue ${data.name}!`;
                                    } else {
                                        document.getElementById('result').innerText = "QR code invalide.";
                                    }
                                });
                        }
                    }
                    requestAnimationFrame(scanQRCode);
                }

                // Démarre le scan
                scanQRCode();
            })
            .catch(function(error) {
                console.error("Erreur d'accès à la caméra : ", error);
                document.getElementById('result').innerText = "Impossible d'accéder à la caméra.";
            });
    </script>
</body>
</html>
